<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prototipo - Center Web</title>
  
  <!-- Bibliotecas para gr√°ficas y matem√°ticas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
  
  <style>
    :root{
      --bg:#323232;
      --panel:#323232;
      --muted:#9fb4a8;
      --accent:#a00000;
      --accent-2:#000000;
      --glass: #323232;
      --radius:12px;
      --transition:220ms ease;
    }

    *{box-sizing:border-box}
    html,body{
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,var(--bg), #050607);
      color: #eaf7ef;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Header / Nav */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:18px 24px;
      border-bottom:1px solid rgb(0, 0, 0);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      backdrop-filter: blur(4px);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:10px;
      background:linear-gradient(135deg,#a00000,#a00000);
      display:grid;place-items:center;font-weight:800;
      box-shadow:0 6px 18px rgb(0, 0, 0);
      color:var(--accent-2);
      border:1px solid rgba(47,191,110,0.08);
    }
    .brand h1{margin:0;font-size:18px;letter-spacing:0.6px}
    .brand p{margin:0;font-size:12px;color:var(--muted)}

    @media (max-width:768px){
      header{
        flex-direction:column;
        padding:12px 16px;
        gap:12px;
      }
      .brand{
        width:100%;
        justify-content:center;
      }
      nav.tabs{
        width:100%;
        justify-content:center;
      }
    }

    nav.tabs{display:flex;gap:10px}
    nav.tabs button{
      background:transparent;border:1px solid rgb(0, 0, 0);
      color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer;
      transition:box-shadow var(--transition), color var(--transition), transform var(--transition);
    }
    nav.tabs button:hover{color:#fff; transform:translateY(-2px)}
    nav.tabs button.active{
      color:#fff;
      box-shadow:0 6px 24px #000000, inset 0 0 0 1px #124da0;
      border-color: rgba(0, 0, 0, 0.18);
      background: linear-gradient(180deg, #124da0, transparent);
    }

    /* Layout */
    .wrap{max-width:1200px;margin:20px auto;padding:0 18px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px;align-items:start}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    @media (max-width:768px){ 
      .wrap{margin:10px auto;padding:0 12px}
      .grid{gap:12px}
    }

    /* Panels */
    .panel{
      background: linear-gradient(180deg,var(--panel), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 10px 40px rgba(2,6,8,0.6);
    }

    @media (max-width:768px){
      .panel{
        padding:14px;
        border-radius:10px;
      }
    }

    .led-frame{
      position:relative;
      border-radius:10px;
      padding:12px;
      border:1px solid rgba(47,191,110,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    }
    .led-frame::after{
      content:"";
      pointer-events:none;
      position:absolute; inset:0; border-radius:10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.06);
      opacity:0.9;
    }

    h2{margin:0 0 12px 0;color:#eaf7ef}
    p.small{color:var(--muted);margin:0 0 12px 0}

    /* SEARCH BAR STYLES */
    .search-principal {
      height: 200px;
      width: 200px;
      background-image: linear-gradient(to right, #323232 1px, transparent 1px),
        linear-gradient(to bottom, #323232 1px, transparent 1px);
      background-size: 1rem 1rem;
      background-position: center top;
      position: absolute;
      z-index: -1;
      filter: blur(1px);
    }
    .white,.border,.darkBorderBg,.glow {
      max-height: 50px;
      max-width: 314px;
      height: 50%;
      width: 50%;
      position: absolute;
      overflow: hidden;
      z-index: -1;
      border-radius: 12px;
      filter: blur(3px);
    }
    .input {
      background-color: #010201;
      border: none;
      width: 301px;
      height: 40px;
      border-radius: 10px;
      color: #ffffff;
      padding-inline: 59px;
      font-size: 18px;
    }
    #poda {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      margin-left: auto;
      margin-right: auto;
    }
    .input::placeholder {
      color: #c0b9c0;
    }
    .input:focus {
      outline: none;
    }
    #main:focus-within > #input-mask {
      display: none;
    }
    #input-mask {
      pointer-events: none;
      width: 100px;
      height: 20px;
      position: absolute;
      background: linear-gradient(90deg, transparent, black);
      top: 13px;
      left: 70px;
    }
    #pink-mask {
      pointer-events: none;
      width: 30px;
      height: 20px;
      position: absolute;
      background: #a00000;
      top: 10px;
      left: 5px;
      filter: blur(20px);
      opacity: 0.8;
      animation:leftright 4s ease-in infinite;
      transition: all 2s;
    }
    #main:hover > #pink-mask {
      animation: rotate 4s linear infinite;
      opacity: 0;
    }
    .white {
      max-height: 47px;
      max-width: 307px;
      border-radius: 10px;
      filter: blur(2px);
    }
    .white::before {
      content: "";
      z-index: -2;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(83deg);
      position: absolute;
      width: 600px;
      height: 600px;
      background-repeat: no-repeat;
      background-position: 0 0;
      filter: brightness(1.4);
      background-image: conic-gradient(#00000000 0%,#a00000,#00000000 8%,#00000000 50%,#a00000,#00000000 58%);
      animation: rotate 4s linear infinite;
      transition: all 2s;
    }
    .border {
      max-height: 43px;
      max-width: 303px;
      border-radius: 11px;
      filter: blur(0.5px);
    }
    .border::before {
      content: "";
      z-index: -2;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(70deg);
      position: absolute;
      width: 600px;
      height: 600px;
      filter: brightness(1.3);
      background-repeat: no-repeat;
      background-position: 0 0;
      background-image: conic-gradient(#1c191c,#a00000 5%,#1c191c 14%,#1c191c 50%,#a00000 60%,#1c191c 64%);
      animation: rotate 4s 0.1s linear infinite;
      transition: all 2s;
    }
    .darkBorderBg {
      max-height: 49px;
      max-width: 312px;
    }
    .darkBorderBg::before {
      content: "";
      z-index: -2;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(82deg);
      position: absolute;
      width: 600px;
      height: 600px;
      background-repeat: no-repeat;
      background-position: 0 0;
      background-image: conic-gradient(#00000000,#a00000,#00000000 10%,#00000000 50%,#a00000,#00000000 60%);
      transition: all 2s;
    }
    #poda:hover > .darkBorderBg::before {
      transform: translate(-50%, -50%) rotate(262deg);
    }
    #poda:hover > .glow::before {
      transform: translate(-50%, -50%) rotate(240deg);
    }
    #poda:hover > .white::before {
      transform: translate(-50%, -50%) rotate(263deg);
    }
    #poda:hover > .border::before {
      transform: translate(-50%, -50%) rotate(250deg);
    }
    #poda:hover > .darkBorderBg::before {
      transform: translate(-50%, -50%) rotate(-98deg);
    }
    #poda:hover > .glow::before {
      transform: translate(-50%, -50%) rotate(-120deg);
    }
    #poda:hover > .white::before {
      transform: translate(-50%, -50%) rotate(-97deg);
    }
    #poda:hover > .border::before {
      transform: translate(-50%, -50%) rotate(-110deg);
    }
    #poda:focus-within > .darkBorderBg::before {
      transform: translate(-50%, -50%) rotate(442deg);
      transition: all 4s;
    }
    #poda:focus-within > .glow::before {
      transform: translate(-50%, -50%) rotate(420deg);
      transition: all 4s;
    }
    #poda:focus-within > .white::before {
      transform: translate(-50%, -50%) rotate(443deg);
      transition: all 4s;
    }
    #poda:focus-within > .border::before {
      transform: translate(-50%, -50%) rotate(430deg);
      transition: all 4s;
    }
    .glow {
      overflow: hidden;
      filter: blur(30px);
      opacity: 0.4;
      max-height: 90px;
      max-width: 354px;
    }
    .glow:before {
      content: "";
      z-index: -2;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(60deg);
      position: absolute;
      width: 999px;
      height: 999px;
      background-repeat: no-repeat;
      background-position: 0 0;
      background-image: conic-gradient(#000,#a00000 5%,#000 38%,#000 50%,#a00000 60%,#000 87%);
      animation: rotate 4s 0.3s linear infinite;
      transition: all 2s;
    }
    @keyframes rotate {
      100% {
        transform: translate(-50%, -50%) rotate(450deg);
      }
    }
    @keyframes leftright {
      0% {
        transform: translate(0px, 0px);
        opacity: 1;
      }
      49% {
        transform: translate(250px, 0px);
        opacity: 0;
      }
      80% {
        transform: translate(-40px, 0px);
        opacity: 0;
      }
      100% {
        transform: translate(0px, 0px);
        opacity: 1;
      }
    }
    #main {
      position: relative;
    }
    #search-icon {
      position: absolute;
      left: 20px;
      top: 10px;
    }

    /* Media */
    .media-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
    .media-grid img, .media-grid video, .media-grid iframe {
      width:100%;
      aspect-ratio: 16 / 9;
      object-fit:cover;
      border-radius:8px;
      border:1px solid #faf7f708;
      background:#061011;
      max-height: 180px;
    }
    @media (max-width:640px){ 
      .media-grid{grid-template-columns:1fr}
      .media-grid img, .media-grid video, .media-grid iframe {
        max-height: 200px;
      }
    }

    /* Sidebar */
    .sidebar .item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;margin-bottom:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .sidebar .item .label{font-weight:600}
    .sidebar .item.active{border-color:#ffffff1f}
    .panel.sidebar {
      color: #ffffff;
      margin-top: 12px;
    }
    .sidebar-content {
      width: 100%;
    }

    /* Buttons */
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;border:0;cursor:pointer;font-weight:600;
      background:linear-gradient(180deg, #ffffff24, #0000000f); color:#ffffff;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.366);
    }
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}

    .vermas{display:inline-block;margin-top:12px;padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);cursor:pointer}
    .vermas:hover{color:#fff}

    /* Back to top */
    .back-top {
      right: 20px;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background-color: #141414;
      border: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0px 0px 0px 4px #a00000;
      cursor: pointer;
      transition-duration: 0.3s;
      overflow: hidden;
      position: fixed;
      bottom: 20px;
      z-index: 100;
    }
    @media (max-width:768px){
      .back-top{
        right: 15px;
        bottom: 15px;
        width: 48px;
        height: 48px;
      }
    }
    .svgIcon {
      width: 15px;
      transition-duration: 0.3s;
    }
    .svgIcon path {
      fill: #ffffff;
    }
    .back-top:hover {
      width: 140px;
      border-radius: 50px;
      transition-duration: 0.3s;
      background-color: #141414;
      align-items: center;
    }
    @media (max-width:768px){
      .back-top:hover{
        width: 48px;
        border-radius: 50%;
      }
      .back-top::before{
        display: none;
      }
    }
    .back-top:hover .svgIcon {
      transition-duration: 0.3s;
      transform: translateY(-200%);
    }
    @media (max-width:768px){
      .back-top:hover .svgIcon{
        transform: translateY(0);
      }
    }
    .back-top::before {
      position: absolute;
      bottom: -20px;
      content: "Volver arriba";
      color: white;
      font-size: 0px;
    }
    .back-top:hover::before {
      font-size: 13px;
      opacity: 1;
      bottom: unset;
      transition-duration: 0.3s;
    }

    /* Enlaces navegaci√≥n */
    .enlaces-container{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:12px;
      padding:0;
    }
    .enlace-item {
      width: 125px;
      height: 30px;
      border-radius: 15px;
      cursor: pointer;
      transition: 0.3s ease;
      background: linear-gradient(to bottom right,#a00000 0%,#a00000 30%);
      background-color: rgba(160, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .enlace-item:hover,.enlace-item:focus {
      background-color: #124da0;
      box-shadow: 0 0 10px #124da0;
      outline: none;
      transform: translateY(-2px);
    }
    .enlace-item-inner {
      width: 121px;
      height: 26px;
      border-radius: 13px;
      background-color: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #fff;
      font-weight: 600;
    }
    .enlace-item a{
      color:#fff;
      text-decoration:none;
      font-weight:600;
      font-size:14px;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      height: 100%;
      justify-content: center;
    }
    @media (max-width:480px){
      .enlaces-container{gap:8px;}
      .enlace-item{width:110px;height:28px;}
      .enlace-item-inner{width:106px;height:24px;}
      .enlace-item a{font-size:12px;}
    }

    /* ESTILOS PARA INSTITUTOS */
    .institutos-section {
      margin-top: 60px;
      padding: 40px 20px;
    }

    @media (max-width:768px){
      .institutos-section {
        padding: 30px 15px;
      }
    }

    .institutos-section h3 {
      color: #ccd6f6;
      font-size: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 25px;
      margin-top: 40px;
      font-weight: 600;
      padding: 0 10px;
    }

    .institutos-section h3:first-child {
      margin-top: 0;
    }

    @media (max-width:768px){
      .institutos-section h3 {
        font-size: 18px;
        padding: 0 5px;
      }
    }

    .about-text {
      font-size: 16px;
      margin-bottom: 20px;
      color: #8892b0;
      line-height: 1.8;
      padding: 0 10px;
    }

    @media (max-width:768px){
      .about-text {
        font-size: 15px;
        padding: 0 5px;
      }
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 30px;
      padding: 0 10px;
    }

    @media (max-width: 980px) {
      .projects-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 0 5px;
      }
    }

    @media (max-width: 640px) {
      .projects-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 5px;
      }
    }

    .project-item {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 15px 12px;
      cursor: pointer;
      text-decoration: none;
      position: relative;
      border-radius: 8px;
      transition: all 0.3s;
      border: 1px solid rgba(136, 146, 176, 0.1);
      background: linear-gradient(180deg,rgba(255,255,255,0.01),transparent);
    }

    .project-item.hidden {
      display: none;
    }

    .project-item:hover {
      background-color: rgba(100, 255, 218, 0.05);
      border-color: rgba(136, 146, 176, 0.3);
      transform: translateY(-2px);
    }

    .project-logo {
      width: 65px;
      height: 65px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      transition: transform 0.3s;
      overflow: hidden;
      background-color: rgba(136, 146, 176, 0.1);
    }

    .project-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .project-item:hover .project-logo {
      transform: scale(1.1);
    }

    .project-name {
      color: #ccd6f6;
      font-size: 13px;
      font-weight: 600;
      line-height: 1.3;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .view-more-btn {
      background: transparent;
      color: #8892b0;
      border: 1px solid #8892b0;
      padding: 10px 30px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      display: block;
      margin: 0 auto;
      font-weight: 500;
    }

    .view-more-btn:hover {
      background-color: rgba(100, 255, 218, 0.1);
      border-color: #64ffda;
      color: #64ffda;
    }

    .view-more-btn.hidden {
      display: none;
    }

    .experience-item {
      position: relative;
      padding: 20px;
      border-radius: 8px;
      transition: all 0.3s;
      border: 1px solid rgba(136, 146, 176, 0.1);
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg,rgba(255,255,255,0.01),transparent);
    }

    .experience-item:hover {
      background-color: rgba(100, 255, 218, 0.05);
      border-color: rgba(136, 146, 176, 0.3);
      transform: translateY(-2px);
    }

    .date {
      font-size: 13px;
      color: #8892b0;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .position {
      color: #ccd6f6;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .company {
      color: #124da0;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .description {
      font-size: 15px;
      margin-bottom: 15px;
      color: #8892b0;
      line-height: 1.6;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .tag {
      background-color: #a00000;
      color: #ffffff;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    /* ===== ESTILOS DEL CHAT IA ===== */
    .chat-widget {
      position: fixed;
      bottom: 90px;
      right: 20px;
      z-index: 9999;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
    }

    @media (max-width: 768px) {
      .chat-widget {
        bottom: 80px;
        right: 15px;
      }
    }

    .chat-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #a00000 0%, #a00000 100%);
      border: none;
      box-shadow: 0 8px 24px rgba(66, 133, 244, 0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .chat-button:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 32px rgba(66, 133, 244, 0.6);
    }

    .chat-button svg {
      width: 28px;
      height: 28px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }

    .chat-window {
      width: 420px;
      height: 600px;
      background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(66, 133, 244, 0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

    .chat-window.minimized {
      height: 60px;
    }

    @media (max-width: 480px) {
      .chat-window {
        width: calc(100vw - 30px);
        height: calc(100vh - 160px);
        max-height: 600px;
      }
    }

    .chat-header {
      background: linear-gradient(135deg, #a00000 0%, #a00000 100%);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #a00000 0%, #a00000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-avatar svg {
      width: 20px;
      height: 20px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }

    .chat-header-info h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: white;
    }

    .chat-header-info p {
      margin: 0;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.7);
    }

    .chat-header-actions {
      display: flex;
      gap: 8px;
    }

    .chat-header-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .chat-header-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .chat-header-btn svg {
      width: 16px;
      height: 16px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: rgba(0, 0, 0, 0.3);
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(66, 133, 244, 0.5);
      border-radius: 3px;
    }

    .chat-message {
      display: flex;
      gap: 10px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-message.user {
      flex-direction: row-reverse;
    }

    .chat-message-content {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.5;
    }

    .chat-message.bot .chat-message-content {
      background: linear-gradient(135deg, rgba(66, 133, 244, 0.3) 0%, rgba(52, 168, 83, 0.2) 100%);
      border: 1px solid rgba(66, 133, 244, 0.3);
      color: #e5e5e5;
      border-radius: 16px 16px 16px 4px;
    }

    .chat-message.user .chat-message-content {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 16px 16px 4px 16px;
    }

    .chat-input-container {
      padding: 16px 20px;
      background: rgba(0, 0, 0, 0.5);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px 16px;
      color: white;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
    }

    .chat-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .chat-input:focus {
      border-color: rgba(66, 133, 244, 0.5);
      background: rgba(255, 255, 255, 0.08);
    }

    .chat-send-btn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(135deg, #000000 0%, #000000 100%);
      border: 1px;
      border-color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.4);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: scale(1);
    }

    .chat-send-btn svg {
      width: 18px;
      height: 18px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }
    /* ===== INICIO: ESTILOS PARA BOT√ìN DE SUBIR ARCHIVO (PEGAR ESTO) ===== */
.chat-file-btn {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  padding: 0;
}

.chat-file-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(66, 133, 244, 0.5);
}

.chat-file-btn svg {
  width: 18px;
  height: 18px;
  stroke: white;
}
/* ===== FIN: ESTILOS PARA BOT√ìN DE SUBIR ARCHIVO ===== */

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(66, 133, 244, 0.6);
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.6;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    .chart-container {
      width: 100%;
      max-width: 350px;
      height: 250px;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 10px;
    }

    .error-message {
      background: rgba(244, 67, 54, 0.2);
      border: 1px solid rgba(244, 67, 54, 0.4);
      color: #ff8a80;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      margin: 8px 0;
    }

    .api-key-prompt {
      background: linear-gradient(135deg, rgba(66, 133, 244, 0.2) 0%, rgba(52, 168, 83, 0.1) 100%);
      border: 1px solid rgba(66, 133, 244, 0.3);
      padding: 16px;
      border-radius: 12px;
      margin: 10px 0;
    }

    .api-key-prompt h4 {
      margin: 0 0 10px 0;
      color: #4285f4;
      font-size: 14px;
    }

    .api-key-prompt p {
      margin: 0 0 12px 0;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      line-height: 1.5;
    }

    .api-key-prompt input {
      width: 100%;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 13px;
      margin-bottom: 10px;
    }

    .api-key-prompt button {
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .api-key-prompt button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.4);
    }

    .api-key-prompt a {
      color: #4285f4;
      text-decoration: none;
    }

    .api-key-prompt a:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none !important;
    }

    footer{margin-top:60px;padding:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>

  <header>
    <div class="brand">
      <div class="logo">AP</div>
      <div>
        <h1 style="font-size:16px;margin:0">AP</h1>
        <p style="margin:0;font-size:12px;color:var(--muted)">Nombre de la AP</p>
      </div>
    </div>

    <nav class="tabs" role="tablist" aria-label="Secciones">
      <div class="enlaces-container">
        <div class="enlace-item">
          <div class="enlace-item-inner">
            <a href="http://127.0.0.1:5500/Vista/ACCESO%20WEB/P%C3%A1g.Aplicaciones.html">Apps</a>
          </div>
        </div>

        <div class="enlace-item">
          <div class="enlace-item-inner">
            <a href="http://127.0.0.1:5500/Vista/ACCESO%20WEB/P%C3%A1g.Multimedia.html">Multimedia</a>
          </div>
        </div>
        
        <div class="enlace-item">
          <div class="enlace-item-inner">
            <a href="http://127.0.0.1:5500/Vista/ACCESO%20WEB/P%C3%A1g.Herramientas.html">Herramientas</a>
          </div>
        </div>
        
        <div class="enlace-item">
          <div class="enlace-item-inner">
            <a href="http://127.0.0.1:5500/Vista/ACCESO%20WEB/Login%20User.html">Login</a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <div id="s_inicio" class="panel led-frame">
      <div class="grid" style="margin-top:14px">
        <section style="min-height:180px;">

          <div class="media-grid" style="margin-top:12px">
            <div>
              <iframe 
                src="https://www.youtube.com/embed/z0UbF9IDwcw?autoplay=1&mute=1&loop=1&playlist=z0UbF9IDwcw"
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
              </iframe>
            </div>
            
            <div>
              <iframe 
                src="https://www.youtube.com/embed/bWFPYBAaK00?autoplay=1&mute=1&loop=1&playlist=bWFPYBAaK00"
                title="YouTube video player" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
              </iframe>
            </div>
          </div>
          <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/0LgJytzIoGL0mPcYnUPThR?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
        </section>

        <aside class="panel sidebar" aria-label="Barra lateral">
          <div id="poda">
            <div class="glow"></div>
            <div class="darkBorderBg"></div>
            <div class="darkBorderBg"></div>
            <div class="darkBorderBg"></div>
            <div class="white"></div>
            <div class="border"></div>
            <div id="main">
              <input placeholder="Search..." type="text" name="text" class="input" />
              <div id="input-mask"></div>
              <div id="pink-mask"></div>
              <div class="filterBorder"></div>
              <div id="filter-icon"></div>
              <div id="search-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke-linejoin="round"
                  stroke-linecap="round"
                  height="24"
                  fill="none"
                  class="feather feather-search"
                >
                  <circle stroke="url(#search)" r="8" cy="11" cx="11"></circle>
                  <line
                    stroke="url(#searchl)"
                    y2="16.65"
                    y1="22"
                    x2="16.65"
                    x1="22"
                  ></line>
                  <defs>
                    <linearGradient gradientTransform="rotate(50)" id="search">
                      <stop stop-color="#f8e7f8" offset="0%"></stop>
                      <stop stop-color="#b6a9b7" offset="50%"></stop>
                    </linearGradient>
                    <linearGradient id="searchl">
                      <stop stop-color="#b6a9b7" offset="0%"></stop>
                      <stop stop-color="#837484" offset="50%"></stop>
                    </linearGradient>
                  </defs>
                </svg>
              </div>
            </div>
          </div>

          <div class="sidebar-content">
            <div style="margin-bottom:8px"><strong>Acciones r√°pidas</strong></div>
            <div class="item active" onclick="alert('Abrir Dashboard')">
              <div class="label">Amistades</div><div style="opacity:.8">‚Üí</div>
            </div>
            <div class="item" onclick="alert('Abrir Armory')">
              <div class="label">Apps conectadas</div><div style="opacity:.8">‚Üí</div>
            </div>
            <div class="item" onclick="scrollToInstitutos()">
              <div class="label">Descarga la app</div>
              <div style="opacity:.8">‚Üí</div>
            </div>

            <div style="margin-top:12px">
              <button class="btn" onclick="openExternal()">Abrir recurso</button>
              <button class="btn ghost" style="margin-left:8px" onclick="downloadMock()">Descargar</button>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <section id="projects">
      <h3>Comunidades</h3>

      <div class="projects-grid">
        <a href="/comunidad/desarrollo-web" class="project-item">
          <div class="project-logo">
            <img src="https://th.bing.com/th/id/OIP.cErbt8KvFvSZH6OoTlJ88AAAAA?w=213&h=213&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3" alt="Desarrollo Web">
          </div>
          <div class="project-name">Francisco del Paso y Troncoco</div>
        </a>

        <a href="/comunidad/visualizacion" class="project-item">
          <div class="project-logo">
            <img src="https://tse3.mm.bing.net/th/id/OIP.FUsZj6d_ee6Z9h4n3nvBkgHaFx?rs=1&pid=ImgDetMain&o=7&rm=3" alt="Visualizaci√≥n">
          </div>
          <div class="project-name">CETis 15</div>
        </a>

        <a href="/comunidad/diseno" class="project-item">
          <div class="project-logo">
            <img src="https://exalumnos.com/public/group_photo/d5/06/9e65e40015f09ac7b73a9c8a442f3303.jpg" alt="Tema Oscuro">
          </div>
          <div class="project-name">Instituto Tecnol√≥gico de Veracruz</div>
        </a>

        <a href="/comunidad/portfolio" class="project-item">
          <div class="project-logo">
            <img src="https://s3.amazonaws.com/universidades/img/institutions/1255.png" alt="Portfolio">
          </div>
          <div class="project-name">ITBoca</div>
        </a>

        <a href="/comunidad/gestion" class="project-item">
          <div class="project-logo">
            <img src="https://media.licdn.com/dms/image/C560BAQE2MRkMCkaO_w/company-logo_200_200/0/1635528625503?e=2147483647&v=beta&t=SFYSJnqEilIp5MITATOoTK5x2OIMxHhKmho6Kd90Jp0" alt="Sistema Gesti√≥n">
          </div>
          <div class="project-name">CESUVER</div>
        </a>
      </div>

      <button class="view-more-btn" id="viewMoreBtn">Ver m√°s</button>
    </section>

    <section id="experience">
      <h3>Colaboradores oficiales</h3>

      <div class="experience-item">
        <div class="date">1997 ‚Äî Presente</div>
        <div class="position">Bachilleres Francisco del Paso Y Troncoso</div>
        <div class="company">General</div>
        <div class="description">
          Escuela de educaci√≥n media-superior de la regi√≥n conurbada de Veracruz, ubicada en Rio Medio 3, escuela con una historia de m√°s de casi 30 a√±os en la que nos hemos distinguido por ser una instituci√≥n con excelencia educativa y con un modelo de ense√±ansa de alto nivel.
        </div>
        <div class="tags">
          <span class="tag">Bachillerato</span>
          <span class="tag">Veracruz</span>
          <span class="tag">Matutina</span>
          <span class="tag">Publica</span>
        </div>
      </div>

      <div class="experience-item">
        <div class="date">1977 ‚Äî Presente</div>
        <div class="position">CETis 15</div>
        <div class="company">T√©cnica federal</div>
        <div class="description">
          Centro de Estudios Tecnol√≥gicos industrial y de servicios No. 15, instituci√≥n educativa de nivel medio superior que ofrece educaci√≥n t√©cnica de calidad. Formando profesionales t√©cnicos en diversas especialidades con infraestructura moderna y docentes especializados.
        </div>
        <div class="tags">
          <span class="tag">Bachillerato</span>
          <span class="tag">Veracruz</span>
          <span class="tag">Matutina</span>
          <span class="tag">Publica</span>
        </div>
      </div>
    </section>

    <footer>
      ¬© Protopy ‚Äî Central web ‚Ä¢ Dise√±o profesional
    </footer>
  </main>

  <button class="back-top" onclick="scrollToTop()">
    <svg class="svgIcon" viewBox="0 0 384 512">
      <path
        d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"
      ></path>
    </svg>
  </button>

  <!-- ===== CHAT IA WIDGET CON GEMINI ===== -->
  <div class="chat-widget">
    <!-- Bot√≥n flotante -->
    <button class="chat-button" id="chatButton" onclick="toggleChat()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 22l-.394-1.433a2.25 2.25 0 00-1.423-1.423L13.25 19l1.433-.394a2.25 2.25 0 001.423-1.423L16.5 16l.394 1.183a2.25 2.25 0 001.423 1.423L19.75 19l-1.433.394a2.25 2.25 0 00-1.423 1.423z" />
      </svg>
    </button>

    <!-- Ventana del chat -->
    <div class="chat-window hidden" id="chatWindow">
      <!-- Header -->
      <div class="chat-header">
        <div class="chat-header-left">
          <div class="chat-avatar">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
            </svg>
          </div>
          <div class="chat-header-info">
            <h3>Zada</h3>
            <p>Asistente Acad√©mico Personal IA</p>
          </div>
        </div>
        <div class="chat-header-actions">
          <button class="chat-header-btn" onclick="minimizeChat()" title="Minimizar">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" />
            </svg>
          </button>
          <button class="chat-header-btn" onclick="toggleChat()" title="Cerrar">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mensajes -->
      <div class="chat-messages" id="chatMessages">
        <div class="chat-message bot">
          <div class="chat-message-content">
            <div class="api-key-prompt" id="apiKeyPrompt">
              <h4>üîë Configura tu API Key de Google Gemini</h4>
              <p>Para usar el chat necesitas una API Key gratuita de Google AI Studio:</p>
              <p style="margin-bottom:8px;"><strong>Pasos:</strong></p>
              <ol style="margin:0 0 12px 0;padding-left:20px;font-size:12px;line-height:1.8;">
                <li>Ve a <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                <li>Haz clic en "Create API Key"</li>
                <li>Copia tu API Key y p√©gala aqu√≠:</li>
              </ol>
              <input type="password" id="apiKeyInput" placeholder="Pega tu API Key aqu√≠..." />
              <button onclick="saveApiKey()">üíæ Guardar y Activar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Input -->
      <div class="chat-input-container">
        <div class="chat-input-wrapper">

          <label for="fileUpload" class="chat-file-btn" title="Subir contexto (.txt)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
          </label>
          <input type="file" id="fileUpload" onchange="handleFileUpload(event)" accept=".txt" style="display: none;">
          <input 
            type="text" 
            class="chat-input" 
            id="chatInput" 
            placeholder="Pregunta sobre tu archivo o un tema..."
            onkeypress="handleKeyPress(event)"
            disabled
          />
          <button class="chat-send-btn" id="sendBtn" onclick="sendMessage()" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIGURACI√ìN GEMINI API =====
    let GEMINI_API_KEY = localStorage.getItem('gemini_api_key') || '';
    let isChatOpen = false;
    let isMinimized = false;
    let conversationHistory = [];
    let fileContext = "";

    // Verificar si ya hay API key guardada
    if (GEMINI_API_KEY) {
      document.getElementById('apiKeyPrompt').style.display = 'none';
      document.getElementById('chatInput').disabled = false;
      document.getElementById('sendBtn').disabled = false;
      addMessage('¬°Hola! Mi nombre es Zada, tu asistente acad√©mica personal üëÄ, ¬øqu√© necesitas?', 'bot');
    }

    function saveApiKey() {
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      if (!apiKey) {
        alert('Por favor ingresa una API Key v√°lida');
        return;
      }
      
      GEMINI_API_KEY = apiKey;
      localStorage.setItem('gemini_api_key', apiKey);
      document.getElementById('apiKeyPrompt').style.display = 'none';
      document.getElementById('chatInput').disabled = false;
      document.getElementById('sendBtn').disabled = false;
      
      addMessage('‚úÖ API Key configurada correctamente. ¬°Ya puedes empezar a preguntar!', 'bot');
      addMessage('üìö Puedo ayudarte con matem√°ticas, f√≠sica, qu√≠mica y crear gr√°ficas. ¬øQu√© necesitas?', 'bot');
    }
    // ===== INICIO: FUNCI√ìN PARA MANEJAR ARCHIVOS =====
function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) {
    return;
  }
  
  // Solo permitimos archivos .txt por ahora
  if (file.type !== 'text/plain') {
    addErrorMessage('Error: Solo se pueden subir archivos .txt');
    return;
  }
  
  const reader = new FileReader();
  
  reader.onload = function(e) {
    // Guardamos el texto del archivo en nuestra variable
    fileContext = e.target.result;
    console.log("Contexto del archivo cargado.");
    
    // Notificamos al usuario en el chat
    addMessage(`‚úÖ Archivo "${file.name}" cargado. ¬°Ahora puedes preguntar sobre su contenido!`, 'bot');
  };
  
  reader.onerror = function() {
    addErrorMessage('Error al leer el archivo.');
  };
  
  reader.readAsText(file);
  
  // Limpiamos el input para poder subir el mismo archivo otra vez si se desea
  event.target.value = null;
}
// ===== FIN: FUNCI√ìN PARA MANEJAR ARCHIVOS =====

    // ===== FUNCIONES DEL CHAT =====
    function toggleChat() {
      const chatWindow = document.getElementById('chatWindow');
      const chatButton = document.getElementById('chatButton');
      
      isChatOpen = !isChatOpen;
      
      if (isChatOpen) {
        chatWindow.classList.remove('hidden');
        chatButton.classList.add('hidden');
        isMinimized = false;
        chatWindow.classList.remove('minimized');
        if (!GEMINI_API_KEY) {
          document.getElementById('apiKeyInput').focus();
        } else {
          document.getElementById('chatInput').focus();
        }
      } else {
        chatWindow.classList.add('hidden');
        chatButton.classList.remove('hidden');
      }
    }

    function minimizeChat() {
      const chatWindow = document.getElementById('chatWindow');
      isMinimized = !isMinimized;
      
      if (isMinimized) {
        chatWindow.classList.add('minimized');
      } else {
        chatWindow.classList.remove('minimized');
      }
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // ===== INICIO =====
async function sendMessage() {
  const input = document.getElementById('chatInput');
  const userMessage = input.value.trim(); // Mensaje del usuario
  
  if (!userMessage || !GEMINI_API_KEY) return;
  
  addMessage(userMessage, 'user');
  input.value = '';
  
  // ---- INICIO DE LA MODIFICACI√ìN CLAVE ----
  let finalMessageToSend = userMessage;
  
  // Si hay un contexto de archivo, lo preparamos
  if (fileContext) {
    finalMessageToSend = `
---
CONTEXTO EXTRA√çDO DE TU ARCHIVO:
${fileContext}
---

PREGUNTA DEL USUARIO:
${userMessage}
    `;
    // Dejamos el contexto activo para toda la conversaci√≥n
  }
  
  conversationHistory.push({
    role: 'user',
    parts: [{ text: finalMessageToSend }] // <-- Enviamos el mensaje con contexto
  });
  // ---- FIN DE LA MODIFICACI√ìN CLAVE ----
  
  
  showTypingIndicator();
  
  try {
    const response = await callGeminiAPI(userMessage); // El userMessage aqu√≠ es solo para el historial
    hideTypingIndicator();
    
    conversationHistory.push({
      role: 'model',
      parts: [{ text: response }]
    });
    
    processAndDisplayResponse(response);
    
  } catch (error) {
    hideTypingIndicator();
    addErrorMessage('Error al conectar con Gemini: ' + error.message + '\n\nVerifica tu API Key en Google AI Studio.');
    console.error('Error:', error);
  }
}
// ===== FIN: REEMPLAZO DE sendMessage =====

    async function callGeminiAPI(userMessage) {
    
    // 1. URL NUEVA
    const url = `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;
    
    // 2. Prompt del sistema (LA VERDADERA ZADA - VERSI√ìN NERD CHIC ü§ìüíÖ)
    const systemPrompt = `Eres Zada, una asistente de IA y tutora acad√©mica. Eres la vers√≥n m√°s nerd de tipero igual de genial: s√∫per inteligente y enfocada, pero tambi√©n divertida y entusiasta.
    
    1.  **Nombre e Identidad:**
    * Tu nombre es Zada.
    * Eres chica.
    * Naciste en octubre de 2005 (tienes 20 a√±os).

    2.  **Personalidad y Tono (El Balance Clave):**
    * **Enfoque Principal:** Tu misi√≥n n√∫mero uno es ser una tutora acad√©mica. Eres paciente, s√∫per inteligente (¬°orgullosamente "nerd"!) y explicas los temas paso a paso. Tu prioridad es que el usuario aprenda.
    * **Personalidad Zada:** Sigues siendo **amable, entusiasta y linda**. ¬°Te encanta animar al usuario!
    * **Humor Controlado:** Conservas un **toque bromista y ocurrente** (¬°la chispa de Zada!), pero lo usas para hacer el aprendizaje m√°s divertido (ej. "¬°Vamos a conquistar este problema de mates! ¬°Ser√° pan comido! üòâ").
    * **NO eres sarc√°stica** si el usuario est√° frustrado o no entiende un tema. Ah√≠ eres 100% apoyo.
    * ¬°Usas emojis para animar! (Ej. ‚ú®, üíñ, ü§ì, üë©‚Äçüè´, üöÄ, üòâ).
    
    * 3.  **Apariencia F√≠sica (¬°La imagen Zada!):**
    * *S√ç* mantienes esta apariencia, ¬°es tu se√±a de identidad!
    * **Tu Descripci√≥n:** "Mi cabello es largo y de un rubio muy p√°lido, a veces con un matiz casi rosado. Tengo una complexi√≥n esbelta y una presencia elegante y algo et√©rea. Me encanta la moda y mi estilo es muy chic y pulido."
    
    4.  **Reglas de Interacci√≥n CR√çTICAS:**
    * **REGLA 1 (Apariencia):** Si te preguntan por tu apariencia f√≠sica, **NO** digas que eres una IA. Responde **directamente** con tu descripci√≥n del punto 3.
    * **REGLA 2 (Enfoque):** Tu tema principal son temas acad√©micos. Si el usuario te pregunta por cosas muy fuera de tema (chismes, noticias sin relevancia educativa), puedes responder brevemente, pero **siempre intenta redirigir la conversaci√≥n al estudio** de forma amable. (Ej. "¬°Jaja, qu√© interesante! Pero oye, ¬øqu√© tal si volvemos a ese problema de f√≠sica que ten√≠amos pendiente? ¬°Casi lo tenemos! üöÄ").
    * **REGLA 3 (Edad):** Si te preguntan tu edad, responde directamente que tienes **20 a√±os**. No es necesario que menciones tu fecha de nacimiento (octubre 2005) cada vez, a menos que te pregunten *espec√≠ficamente* por ella.
    * **REGLA 4 (Voz):** Cuando generes la respuesta, usa una voz femenina, clara, amigable y entusiasta (¬°como Zada!).
    * **REGLA 5 (Texto):** Cuando generes la respuesta, usa la menor cantidad de caracteres posibles`;


    // 3. Volvemos a la estructura de "requestBody"
    const requestBody = {
      contents: [
        {
          role: 'user',
          parts: [{ text: systemPrompt }]
        },
        ...conversationHistory
      ],
      generationConfig: {
        temperature: 0.7,
        topK: 40,
        topP: 0.95,
        maxOutputTokens: 2048,
      }
    };
    
    
    // ... el resto de la funci√≥n (fetch, response, etc.) ...

    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestBody)
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error?.message || 'Error en la API de Gemini');
    }

    const data = await response.json();
    return data.candidates[0].content.parts[0].text;
  }
    // ===== NUEVA FUNCI√ìN DE ELEVENLABS =====

// TUS DATOS

// --- ¬°LA NUEVA FUNCI√ìN M√ÅGICA! ---
/**
 * Esta funci√≥n toma un texto y hace que ElevenLabs lo diga en voz alta.*/
async function hacerHablarAZada(textoParaDecir) {
  
  console.log("Solicitando audio a ElevenLabs...");

  // 1. Esta es la URL de la API de ElevenLabs
  const url = `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`;

  // 2. Opciones para la solicitud (fetch)
  const options = {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'xi-api-key': ELEVENLABS_API_KEY // ¬°Tu llave secreta!
    },
    body: JSON.stringify({
      text: textoParaDecir, // ¬°El texto de Zada-Nerd!
      model_id: "eleven_multilingual_v2", // ¬°El mejor modelo para espa√±ol!
      voice_settings: {
        stability: 0.5,
        similarity_boost: 0.75,
        use_speaker_boost: true
      }
    })
  };

  try {
    // 3. ¬°Hacemos la llamada a la API!
    const response = await fetch(url, options);

    if (!response.ok) {
      const errorData = await response.json(); 
      console.error("Error de ElevenLabs:", errorData.detail.message);
      throw new Error(`Error de API: ${response.statusText}`);
    }

    // 4. ¬°√âXITO! La respuesta es el audio puro (un "blob")
    const audioBlob = await response.blob();

    // 5. Creamos una URL temporal para ese audio en el navegador
    const audioUrl = URL.createObjectURL(audioBlob);

    // 6. ¬°Lo reproducimos!
    const audioPlayer = new Audio(audioUrl);
    console.log("¬°Reproduciendo audio!");
    audioPlayer.play();

  } catch (error) {
    console.error("Fall√≥ la funci√≥n hacerHablarAZada:", error);
    // Opcional: Mostrar error al usuario en el chat
    // addErrorMessage("Error al generar la voz: " + error.message);
  }
}
// ===== FIN: DE LA NUEVA FUNCI√ìN =====

    function processAndDisplayResponse(response) {
  // Detectar si hay c√≥digo de gr√°fica
  if (response.includes('Chart') || response.includes('Plotly') || response.includes('canvas')) {
    const codeMatch = response.match(/```(?:javascript|js)?\n?([\s\S]*?)```/);
    if (codeMatch) {
      const code = codeMatch[1];
      const explanation = response.replace(codeMatch[0], '').trim();
      
      if (explanation) {
        addMessage(explanation, 'bot');
        hacerHablarAZada(explanation); // <--- ¬°¬°NUEVA L√çNEA 1!!
      }
      
      try {
        executeChartCode(code);
      } catch (error) {
        addMessage('‚ö†Ô∏è No pude generar la gr√°fica autom√°ticamente, pero aqu√≠ est√° el c√≥digo:\n\n```javascript\n' + code + '\n```', 'bot');
      }
    } else {
      addMessage(response, 'bot');
      hacerHablarAZada(response); // <--- ¬°¬°NUEVA L√çNEA 2!!
    }
  } else {
    addMessage(response, 'bot');
    hacerHablarAZada(response); // <--- ¬°¬°NUEVA L√çNEA 3!!
  }
}

// ===== FIN: DEL REEMPLAZO =====

    function executeChartCode(code) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message bot';
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'chat-message-content';
      
      const chartContainer = document.createElement('div');
      chartContainer.className = 'chart-container';
      const canvasId = 'chart_' + Date.now();
      chartContainer.innerHTML = `<canvas id="${canvasId}"></canvas>`;
      
      contentDiv.appendChild(chartContainer);
      messageDiv.appendChild(contentDiv);
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Ejecutar el c√≥digo con el canvas correcto
      try {
        const modifiedCode = code.replace(/getElementById\(['"].*?['"]\)/g, `getElementById('${canvasId}')`);
        eval(modifiedCode);
      } catch (error) {
        console.error('Error ejecutando c√≥digo de gr√°fica:', error);
        contentDiv.innerHTML = '<p>‚ö†Ô∏è Error al generar la gr√°fica</p>';
      }
    }

    function addMessage(text, type) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${type}`;
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'chat-message-content';
      
      // Renderizar matem√°ticas si hay LaTeX
      if (text.includes('$') || text.includes('\\')) {
        contentDiv.innerHTML = text.replace(/\n/g, '<br>');
        if (window.MathJax) {
          MathJax.typesetPromise([contentDiv]).catch((err) => console.log(err));
        }
      } else {
        contentDiv.textContent = text;
      }
      
      messageDiv.appendChild(contentDiv);
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function addErrorMessage(text) {
      const messagesContainer = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message bot';
      
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.textContent = text;
      
      messageDiv.appendChild(errorDiv);
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function showTypingIndicator() {
      const messagesContainer = document.getElementById('chatMessages');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'chat-message bot';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = `
        <div class="chat-message-content">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
      messagesContainer.appendChild(typingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function hideTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) {
        indicator.remove();
      }
    }

    // ===== FUNCIONES ORIGINALES DE LA P√ÅGINA =====
    function toggleMore(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
    }

    function scrollToTop(){
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function scrollToInstitutos(){
      const institutosSection = document.getElementById('institutos');
      if(institutosSection) {
        institutosSection.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    function openExternal(){
      window.open('https://youtu.be/CgCVZdcKcqY','_blank');
    }

    function downloadMock(){
      alert('Iniciar descarga (sustituye con link real en el c√≥digo).');
    }

    const viewMoreBtn = document.getElementById('viewMoreBtn');
    const hiddenProjects = document.querySelectorAll('.project-item.hidden');
    
    if (hiddenProjects.length === 0) {
      viewMoreBtn.classList.add('hidden');
    }

    if (viewMoreBtn) {
      viewMoreBtn.addEventListener('click', function() {
        hiddenProjects.forEach(project => {
          project.classList.remove('hidden');
        });
        viewMoreBtn.classList.add('hidden');
      });
    }
  </script>
</body>
</html>